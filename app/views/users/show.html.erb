<h1><%= @user.email %></h1>

<% if @user == current_user%>

<a href="<%=new_log_path%>" class="newLog">New Log</a>
<%=link_to "Edit Profile", edit_user_path(@user) %>
<%=link_to "User's Log List", user_logs_path(@user) %>
<%=link_to 'Log Out', logout_path, method: :destroy %>
<%end%>

<div id="logs" data-id="<%=current_user.id%>">
</div>

<div id="form" >

</div>

<p>Total Posts: <%= @user.logs.count %></p>





<script type="text/javascript" charset="utf-8">
    var userId = parseInt($("#logs").attr("data-id"))

    $.get(`/users/${userId}/logs.json`, function(data){
      var logs = data;
      var logList ="";
      logs.forEach(function(log){
        logList+=
        '<h2>'+ log["created_at"] + "</h2>" +
        '<p>'+ 'Calories: ' + log["calories"] +'</p>' +
        '<p>'+ 'Workout Time: ' + log["workout_time"] +'</p>'
      });
      $("#logs").html(logList);
    });

    function Log(attributes){
      this.id = attributes.id;
      this.created_at = attributes.created_at
      this.workout_time = attributes.workout_time
      this.calories = attributes.calories
      this.user = attributes.user
    }

    Log.prototype.renderLi = function() {
      return `<h2>New Log Added!</h2> <p> Calories: ${this.calories} </p> <p>Workout: ${this.workout_time} </p>`;
    }

    $(".newLog").on("click", function(event){
      event.preventDefault();
      $('#form').append("<h2>Add New Log<h2>")
      $('#form').append("<%= escape_javascript render(:partial => 'logs/form',
      :locals => { :l => @log }) %>");

      $("#new_log").on("submit", function(e){
        e.preventDefault();
        $.ajax({
          type: "POST",
          url: this.action,
          data: $(this).serialize(),
          success: function(response){
            let log = new Log(response)
            let html = log.renderLi()
            $("#form").html(html);
          }
        });
      });
    });


</script>
